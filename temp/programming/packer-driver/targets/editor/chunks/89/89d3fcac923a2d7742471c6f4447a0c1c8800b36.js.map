{"version":3,"sources":["file:///C:/CocosWorkspace/Cocos_2048/assets/scripts/Game.ts"],"names":["_decorator","Component","instantiate","Label","Node","NodeEventType","Prefab","randomRangeInt","UITransform","Vec2","view","Block","ccclass","property","gBlockHorizontalNum","gBlockVerticalNum","gRandomGenerateNumbers","gTouchMoveThreshold","Game","type","score","gap","blockSize","blockPositions","blocks","startPosition","endPosition","drawBgBlocks","getVisibleSize","width","y","i","x","push","Array","j","block","blockPrefab","blockUiTransform","getComponent","height","setPosition","setNumber","background","addChild","init","updateScore","length","destroy","addRandomNumberBlock","num","scoreLabel","string","getFreeBlocksXy","freeBlocksXy","index","pos","moveRight","console","log","moveLeft","moveUp","moveDown","addEventHandler","on","TOUCH_START","event","getLocation","TOUCH_END","dirVec","subtract","Math","abs","start","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, NodeEventType, Prefab, randomRangeInt, Sprite, UITransform, Vec2, view } from 'cc';\nimport { colors }  from './Colors';\nimport { Block } from './Block';\nconst { ccclass, property } = _decorator;\n\nconst gBlockHorizontalNum: number = 4;\nconst gBlockVerticalNum: number = 4;\nconst gRandomGenerateNumbers: number[] = [2, 4];\nconst gTouchMoveThreshold: number = 50;\n\n@ccclass('Game')\nexport class Game extends Component {\n    @property({type: Label})\n    private scoreLabel: Label;\n    private score: number = 0;\n    @property({type: Prefab})\n    private blockPrefab: Prefab;\n    private gap: number = 20;\n    @property({type: Node})\n    private background: Node;\n    private blockSize: number = 0;\n    private blockPositions = [];\n    private blocks = [];\n    private startPosition: Vec2;\n    private endPosition: Vec2;\n\n    drawBgBlocks() {\n        this.blockSize = \n            (view.getVisibleSize().width - this.gap * (gBlockHorizontalNum + 1)) / gBlockHorizontalNum;\n\n        this.blockPositions = [];\n        var y = this.gap + this.blockSize / 2;\n        for (var i=0;i<gBlockVerticalNum;++i) {\n            var x = this.gap + this.blockSize / 2;\n            this.blockPositions.push(new Array(gBlockHorizontalNum));\n            for(var j=0;j<gBlockHorizontalNum;++j) {\n                var block = instantiate(this.blockPrefab);\n                var blockUiTransform = block.getComponent(UITransform);\n                blockUiTransform.width = blockUiTransform.height = this.blockSize;\n                block.setPosition(x, y);\n                this.blockPositions[i][j] = new Vec2(x, y);\n                block.getComponent(Block).setNumber(0);\n                this.background.addChild(block);\n                x += this.gap + this.blockSize;\n            }\n            y += this.gap + this.blockSize;\n        }\n        // console.log(this.blockPositions);\n    }\n\n    // 初始化的时候调用一次\n    init() {\n        this.updateScore(0);\n\n        for(var i=0;i<this.blocks.length;++i) {\n            for(var j=0;j<this.blocks[i].length;++j) {\n                if (this.blocks[i][j] != null) {\n                    this.blocks[i][j].destroy();\n                }\n            }\n        }\n\n        this.blocks = [];\n        for (var i=0;i<gBlockVerticalNum;++i) {\n            this.blocks.push(new Array(gBlockHorizontalNum));\n            for (var j=0;j<gBlockHorizontalNum;++j) {\n                this.blocks[i][j] = null;\n            }\n        }\n        // console.log(this.blocks);\n        // console.log(this.getFreeBlocksXy());\n\n        this.addRandomNumberBlock();\n        this.addRandomNumberBlock();\n        this.addRandomNumberBlock();\n    }\n\n    // 更新总分数\n    updateScore(num: number) {\n        this.score = num;\n        this.scoreLabel.string = '分数: ' + num;\n    }\n\n    // 获取空白块的xy下标\n    getFreeBlocksXy() {\n        var freeBlocksXy = [];\n        for(var i = 0; i<this.blocks.length;++i) {\n            for(var j =0;j<this.blocks[i].length;++j) {\n                if (this.blocks[i][j] == null) {\n                    freeBlocksXy.push([i, j]);\n                }\n            }\n        }\n        return freeBlocksXy;\n    }\n\n    // 随机在空白位置处添加一个数字块\n    addRandomNumberBlock() {\n        var freeBlocksXy = this.getFreeBlocksXy();\n        if (freeBlocksXy.length == 0) return false;\n        var index = freeBlocksXy[randomRangeInt(0, freeBlocksXy.length)];\n        // console.log(index);\n        var pos = this.blockPositions[index[0]][index[1]];\n        // console.log(pos);\n        var block = instantiate(this.blockPrefab);\n        var blockUiTransform = block.getComponent(UITransform);\n        blockUiTransform.width = blockUiTransform.height = this.blockSize;\n        block.setPosition(pos.x, pos.y);\n        // console.log(gRandomGenerateNumbers[randomRangeInt(0, gRandomGenerateNumbers.length)]);\n        block.getComponent(Block).setNumber(gRandomGenerateNumbers[randomRangeInt(0, gRandomGenerateNumbers.length)]);\n        this.background.addChild(block);\n        // console.log(this.background.children)\n        this.blocks[index[0]][index[1]] = block;\n        return true;\n    }\n\n    moveRight() {\n        console.log('move right');\n    }\n\n    moveLeft() {\n        console.log('move left');\n    }\n\n    moveUp() {\n        console.log('move up');\n    }\n\n    moveDown() {\n        console.log('move down');\n    }\n\n    addEventHandler() {\n        this.background.on(NodeEventType.TOUCH_START, (event) => {\n            this.startPosition = event.getLocation();\n            // console.log(this.startPosition);\n        });\n\n        this.background.on(NodeEventType.TOUCH_END, (event) => {\n            this.endPosition = event.getLocation();\n            // console.log(this.endPosition);\n            var dirVec = this.endPosition.subtract(this.startPosition);\n            // console.log(dirVec);\n            if (dirVec.length() > gTouchMoveThreshold) {\n                if (Math.abs(dirVec.x) > Math.abs(dirVec.y)) { // 水平滑动\n                    if (dirVec.x > 0) {\n                        this.moveRight();\n                    } else {\n                        this.moveLeft();\n                    }\n                } else { // 竖直滑动\n                    if (dirVec.y > 0) {\n                        this.moveUp();\n                    } else {\n                        this.moveDown();\n                    }\n                }\n            }\n        });\n    }\n\n    start() {\n        this.drawBgBlocks();\n        this.init();\n        this.addEventHandler();\n    }\n\n    update(deltaTime: number) {\n        \n    }\n}\n\n"]}